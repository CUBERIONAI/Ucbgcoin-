<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukrainian Cyborgs v1.7 (Premium)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        /* --- PREMIUM LIGHT THEME --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.85);
            --text-main: #002b5c; /* –¢–µ–º–Ω–æ-—Å–∏–Ω—ñ–π */
            --text-sec: #555;
            --accent-blue: #0057b8; /* –ü—Ä–∞–ø–æ—Ä —Å–∏–Ω—ñ–π */
            --accent-gold: #ffd700; /* –ü—Ä–∞–ø–æ—Ä –∂–æ–≤—Ç–∏–π */
            --btn-grad: linear-gradient(90deg, #0057b8, #007aff);
            --shadow: 0 4px 15px rgba(0, 87, 184, 0.15);
            --danger: #ff3b30;
            --success: #28cd41;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }

        /* --- UI ELEMENTS --- */
        
        /* Intro Screen - White & Gold */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s;
        }
        .intro-logo { font-size: 60px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
        .intro-btn {
            padding: 15px 40px; border-radius: 30px; border: none;
            background: var(--btn-grad); color: #fff; font-weight: bold; font-size: 16px;
            box-shadow: 0 5px 20px rgba(0, 87, 184, 0.3); cursor: pointer;
        }

        /* Header */
        .top-bar {
            width: 100%; max-width: 420px; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box;
        }
        .settings-icon { font-size: 24px; color: var(--text-main); cursor: pointer; }

        /* Main Container */
        .container { width: 100%; max-width: 420px; padding: 0 15px; box-sizing: border-box; text-align: center; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }

        h1 { 
            font-size: 18px; color: var(--accent-blue); 
            text-transform: uppercase; letter-spacing: 2px; margin: 0; font-weight: 800;
        }

        .balance-val { 
            font-size: 52px; font-weight: 800; color: var(--text-main); 
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 1);
            margin-top: 5px; 
        }
        
        .league-badge {
            display: inline-block; padding: 6px 16px; border-radius: 20px;
            background: #fff; border: 1px solid #ddd;
            font-size: 12px; font-weight: bold; margin-top: 5px; color: var(--text-sec);
            box-shadow: var(--shadow);
        }

        /* Trident Button - Premium Look */
        .clicker-area {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            margin: 10px 0; position: relative; width: 100%;
        }
        .main-btn {
            width: 70vw; height: 70vw; max-width: 280px; max-height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffffff, #e6f4ff);
            border: 4px solid #fff;
            box-shadow: 0 10px 40px rgba(0, 87, 184, 0.2), inset 0 0 20px rgba(0,0,0,0.05);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.05s;
            -webkit-touch-callout: none;
        }
        .main-btn:active { transform: scale(0.96); }

        .trident-svg { width: 65%; height: 65%; filter: drop-shadow(0 5px 10px rgba(0, 87, 184, 0.2)); pointer-events: none; }
        
        /* Gradient for Trident SVG fill */
        .trident-anim { animation: breathe 3s infinite ease-in-out; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }

        /* Energy */
        .energy-bar {
            width: 100%; height: 12px; background: #e0e0e0; border-radius: 6px;
            overflow: hidden; margin-top: auto; margin-bottom: 5px;
        }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #0057b8); width: 100%; transition: width 0.3s; }
        .energy-info { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sec); margin-bottom: 15px; font-weight: 600; }

        /* Floating Numbers */
        .floating-txt {
            position: absolute; color: var(--accent-blue); font-weight: 900; font-size: 32px;
            text-shadow: 0 2px 0 #fff;
            pointer-events: none; z-index: 1000;
            animation: floatUp 0.6s ease-out forwards;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-100px) scale(1.5); opacity: 0; } }

        /* Nav Bar - Glassmorphism */
        .nav-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 94%; max-width: 400px; 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid rgba(255,255,255,0.5);
            display: flex; justify-content: space-around; padding: 12px 0; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; font-weight: 600; }
        .nav-btn.active { color: var(--accent-blue); }
        .nav-icon { font-size: 22px; margin-bottom: 3px; }

        /* Modals - Clean Card Style */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; justify-content: center; align-items: flex-end; }
        .modal-card { 
            background: #f9f9f9; width: 100%; max-width: 500px; 
            border-radius: 30px 30px 0 0; padding: 30px 25px; 
            max-height: 85vh; overflow-y: auto; color: var(--text-main); 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
        }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #999; cursor: pointer; }
        
        .upg-row { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #fff; padding: 15px; border-radius: 16px; 
            margin-bottom: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); 
            border: 1px solid #eee;
        }
        .btn { 
            background: var(--accent-blue); color: #fff; border: none; 
            padding: 10px 20px; border-radius: 12px; font-weight: bold; font-size: 12px; cursor: pointer; 
            box-shadow: 0 4px 10px rgba(0, 87, 184, 0.2);
        }
        .btn:disabled { background: #ccc; box-shadow: none; }
        .btn-action { background: var(--success); color: #fff; border:none; padding:8px 15px; border-radius:10px; font-weight:bold; }

        /* Staking & Vouchers */
        .staking-card { 
            background: #fff; border: 1px solid #eee; border-radius: 16px; 
            padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .staking-active { border: 2px solid var(--accent-gold); background: #fffdf0; }
        
        .friend-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; font-weight: 500; }

        /* Fix TON Connect */
        #tc-widget-root, tc-root { z-index: 10000 !important; position: relative; }

    </style>
</head>
<body>

    <div id="intro-layer">
        <div class="intro-logo">üõ°Ô∏èüá∫üá¶</div>
        <h2 style="color:var(--text-main); margin-bottom:5px;">UKRAINIAN CYBORGS</h2>
        <p style="color:var(--text-sec); margin-bottom:30px;">ELITE EDITION</p>
        <button class="intro-btn" onclick="startGame()">–†–û–ó–ü–û–ß–ê–¢–ò</button>
    </div>

    <div class="top-bar">
        <div></div>
        <div class="settings-icon" onclick="openModal('settingsModal')">‚öôÔ∏è</div>
    </div>

    <div class="container">
        <h1>UKRAINIAN CYBORGS</h1>

        <div>
            <div class="balance-val" id="displayBalance">0</div>
            <div class="league-badge" id="leagueDisplay">Bronze</div>
        </div>

        <div class="clicker-area">
            <div class="main-btn" id="tapBtn">
                <svg class="trident-svg trident-anim" viewBox="0 0 512 512">
                    <defs>
                        <linearGradient id="flagGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="50%" style="stop-color:#0057b8;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ffd700;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#flagGrad)" d="M256 32C242.7 32 232 42.7 232 56V192C232 222.9 206.9 248 176 248C145.1 248 120 222.9 120 192V88C120 74.7 109.3 64 96 64C82.7 64 72 74.7 72 88V192C72 249.4 118.6 296 176 296H200V424H152C138.7 424 128 434.7 128 448C128 461.3 138.7 472 152 472H360C373.3 472 384 461.3 384 448C384 434.7 373.3 424 360 424H312V296H336C393.4 296 440 249.4 440 192V88C440 74.7 429.3 64 416 64C402.7 64 392 74.7 392 88V192C392 222.9 366.9 248 336 248C305.1 248 280 222.9 280 192V56C280 42.7 269.3 32 256 32z"/>
                </svg>
            </div>
        </div>

        <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
        <div class="energy-info">
            <span>–ï–ù–ï–†–ì–Ü–Ø</span>
            <span><span id="enVal">1000</span> / <span id="enMax">1000</span></span>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="closeModals()"><div class="nav-icon">üè†</div>–ì–æ–ª–æ–≤–Ω–∞</button>
        <button class="nav-btn" onclick="openModal('tasksModal')"><div class="nav-icon">üì°</div>–ú—ñ—Å—ñ—ó</button>
        <button class="nav-btn" onclick="openModal('upgModal')"><div class="nav-icon">‚ö°</div>–ê–ø–≥—Ä–µ–π–¥</button>
        <button class="nav-btn" onclick="openModal('friendsModal')"><div class="nav-icon">ü§ù</div>–®—Ç–∞–±</button>
        <button class="nav-btn" onclick="openModal('walletModal')"><div class="nav-icon">üíé</div>–§—ñ–Ω–∞–Ω—Å–∏</button>
    </div>

    <div id="upgModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–¢–ï–•–ù–û–õ–û–ì–Ü–á</h2>
            <div id="upgradesList"></div>
            <hr style="border:none; border-top:1px solid #eee; margin:15px 0;">
            <div class="upg-row">
                <div>
                    <div style="font-weight:bold;">üöÄ –¢—É—Ä–±–æ –†–µ–∂–∏–º</div>
                    <div style="font-size:11px; color:#888;">x10 –¥–æ –∫–ª—ñ–∫—É (10 —Å–µ–∫)</div>
                </div>
                <button class="btn" style="background:var(--danger);" onclick="activateRocket()">START</button>
            </div>
        </div>
    </div>

    <div id="tasksModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–ú–Ü–°–Ü–á –ü–Ü–î–¢–†–ò–ú–ö–ò</h2>
            <div class="upg-row">
                <div>
                    <div style="font-weight:bold;">–ö–∞–Ω–∞–ª UCBG</div>
                    <div style="font-size:11px; color:#888;">+1,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" id="task1Btn" onclick="checkTask('task1', 'https://t.me/ucbgcoin')">Go</button>
            </div>
            <div class="upg-row">
                <div>
                    <div style="font-weight:bold;">–ß–∞—Ç –ö—ñ–±–æ—Ä–≥—ñ–≤</div>
                    <div style="font-size:11px; color:#888;">+1,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" id="task2Btn" onclick="checkTask('task2', 'https://t.me/ukrainian_cyborgs_ton')">Go</button>
            </div>
        </div>
    </div>

    <div id="friendsModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–ö–û–ú–ê–ù–î–ù–ò–ô –¶–ï–ù–¢–†</h2>
            <div style="background:#f0f7ff; padding:20px; border-radius:15px; text-align:center; border:1px solid #dbeafe; margin-bottom:20px;">
                <div style="font-size:12px; color:#666;">–ë–û–ù–£–° –ó–ê –†–ï–ö–†–£–¢–ê</div>
                <div style="font-size:24px; font-weight:800; color:var(--accent-blue);">+500,000</div>
            </div>
            <button class="btn" style="width:100%; margin-bottom:20px; font-size:14px;" onclick="invite()">–ó–ê–ü–†–û–°–ò–¢–ò –î–†–£–ì–ê</button>
            
            <h3 style="font-size:14px; color:#999; margin-bottom:10px;">–°–ü–ò–°–û–ö –ë–Ü–ô–¶–Ü–í</h3>
            <div id="friendsList" style="max-height: 200px; overflow-y: auto;">
                <div style="text-align:center; color:#ccc; font-size:12px; margin-top:10px;">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>
            </div>
        </div>
    </div>

    <div id="walletModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–§–Ü–ù–ê–ù–°–ò –¢–ê –ê–ö–¢–ò–í–ò</h2>
            
            <div id="ton-btn" style="margin-bottom:20px; display:flex; justify-content:center;"></div>
            
            <div style="background:#fffdf0; border:1px solid #ffeeba; border-radius:15px; padding:15px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size:11px; color:#856404; font-weight:bold;">–ù–ê–ö–û–ü–ò–ß–ï–ù–û (STAKING)</div>
                    <button class="btn-action" onclick="harvestStaking()">–ó–Ü–ë–†–ê–¢–ò</button>
                </div>
                <div id="stakingBalance" style="font-size:24px; color:#28a745; font-weight:800; margin-top:5px;">0.00</div>
            </div>

            <h3 style="font-size:14px; margin-bottom:10px; color:#666;">–î–ï–ü–û–ó–ò–¢–ò (TON)</h3>
            <div id="stakingOptions"></div>

            <hr style="border:none; border-top:1px solid #eee; margin:20px 0;">
            
            <h3 style="font-size:14px; margin-bottom:10px; color:#666;">NFT –í–ê–£–ß–ï–†–ò</h3>
            <div class="upg-row" style="border-left: 4px solid var(--accent-blue);">
                <div>
                    <div style="font-weight:bold;">UCBG Voucher</div>
                    <div style="font-size:11px; color:#888;">–¶—ñ–Ω–∞: 10,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" onclick="mintVoucher()">–ö–£–ü–ò–¢–ò</button>
            </div>
            <div style="text-align:center; font-size:12px; color:#888;">–í–∞—É—á–µ—Ä—ñ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å—ñ: <span id="voucherCount" style="color:var(--text-main); font-weight:bold;">0</span></div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø</h2>
            <div style="text-align:center; margin-top:20px; color:#999; font-size:12px;">
                UCBG v1.7 Premium<br>–°–ª–∞–≤–∞ –£–∫—Ä–∞—ó–Ω—ñ! üá∫üá¶
            </div>
        </div>
    </div>

    <script>
        // --- CORE ---
        const TG = window.Telegram.WebApp;
        TG.expand(); TG.setHeaderColor('#ffffff');

        // Refs
        const elBalance = document.getElementById('displayBalance');
        const elEnergyFill = document.getElementById('energyFill');
        const elEnVal = document.getElementById('enVal');
        const elEnMax = document.getElementById('enMax');
        const elTapBtn = document.getElementById('tapBtn');
        const elLeague = document.getElementById('leagueDisplay');

        // Data
        const LEAGUES = [
            { name: "Recruit", limit: 0, color: "#cd7f32" },
            { name: "Soldier", limit: 500000, color: "#c0c0c0" },
            { name: "Captain", limit: 2000000, color: "#ffd700" },
            { name: "Cyborg", limit: 10000000, color: "#0057b8" }
        ];

        const STAKING_PLANS = [
            { id: 0, ton: 1, yieldDay: 50000 },
            { id: 1, ton: 10, yieldDay: 1000000 },
            { id: 2, ton: 100, yieldDay: 15000000 },
            { id: 3, ton: 1000, yieldDay: 50000000 }
        ];

        let game = {
            balance: 0,
            energy: 1000,
            leagueIndex: 0,
            vouchers: 0,
            staking: { activePlan: -1, accumulated: 0, lastCalc: Date.now() },
            friends: [],
            tasks: { task1: false, task2: false },
            upgrades: {
                tap: { lvl: 1, base: 500, factor: 2, val: 1 },
                eng: { lvl: 1, base: 500, factor: 2, val: 1000 },
                reg: { lvl: 1, base: 1000, factor: 2.5, val: 2 }
            },
            turboEnd: 0
        };

        // --- INIT ---
        function init() {
            loadGame();

            // Ref Bonus
            const initData = TG.initDataUnsafe;
            if (initData && initData.start_param && game.balance < 1000) {
                game.balance += 250000;
                TG.showAlert("üéÅ –ë–æ–Ω—É—Å –≤—ñ–¥ –¥—Ä—É–≥–∞: +250,000!");
            }

            // Loops
            setInterval(calcStaking, 1000);
            setInterval(regenEnergy, 1000);

            renderUI();
            renderUpgrades();
            renderStaking();
            renderFriends();
            updateTasksUI();

            // TON UI
            new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json',
                buttonRootId: 'ton-btn'
            });
        }

        window.startGame = () => {
            document.getElementById('intro-layer').style.opacity = '0';
            setTimeout(() => document.getElementById('intro-layer').style.display = 'none', 500);
        };

        // --- GAMEPLAY ---
        elTapBtn.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            let power = game.upgrades.tap.val + (game.upgrades.tap.lvl - 1);
            if (Date.now() < game.turboEnd) power *= 10;

            if (game.energy >= power) {
                game.balance += power;
                game.energy -= power;
                
                if(TG.HapticFeedback) TG.HapticFeedback.impactOccurred('light');
                
                // Animation
                elTapBtn.style.transform = "scale(0.95)";
                setTimeout(() => elTapBtn.style.transform = "scale(1)", 80);
                showFloatingText(e.clientX, e.clientY, `+${power}`);

                checkLeague();
                renderUI();
                saveGame();
            }
        });

        function showFloatingText(x, y, txt) {
            let el = document.createElement('div');
            el.className = 'floating-txt';
            el.textContent = txt;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 40) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }

        function checkLeague() {
            let next = game.leagueIndex + 1;
            if (next < LEAGUES.length && game.balance >= LEAGUES[next].limit) {
                game.leagueIndex = next;
                TG.showAlert(`üèÜ –ù–æ–≤–µ –∑–≤–∞–Ω–Ω—è: ${LEAGUES[next].name}!`);
            }
        }

        function regenEnergy() {
            let max = game.upgrades.eng.val;
            if (game.energy < max) {
                game.energy = Math.min(max, game.energy + game.upgrades.reg.val);
                renderUI();
            }
        }

        // --- STAKING LOGIC ---
        function renderStaking() {
            const container = document.getElementById('stakingOptions');
            container.innerHTML = '';
            STAKING_PLANS.forEach(plan => {
                let isActive = (game.staking.activePlan === plan.id);
                let cls = isActive ? "staking-card staking-active" : "staking-card";
                let btnTxt = isActive ? "–ê–ö–¢–ò–í–ù–û" : "–í–ö–õ–ê–°–¢–ò";
                let btnState = isActive ? "disabled" : "";
                
                container.innerHTML += `
                <div class="${cls}">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:bold; color:#002b5c;">${plan.ton} TON</div>
                            <div style="font-size:11px; color:#28a745;">+${(plan.yieldDay).toLocaleString()} / –¥–µ–Ω—å</div>
                        </div>
                        <button class="btn" onclick="activateStaking(${plan.id})" ${btnState}>${btnTxt}</button>
                    </div>
                </div>`;
            });
        }

        window.activateStaking = (id) => {
            TG.showConfirm(`–ó–∞–º–æ—Ä–æ–∑–∏—Ç–∏ ${STAKING_PLANS[id].ton} TON?`, (ok) => {
                if(ok) {
                    game.staking.activePlan = id;
                    game.staking.lastCalc = Date.now();
                    TG.showAlert("‚úÖ –î–µ–ø–æ–∑–∏—Ç –≤—ñ–¥–∫—Ä–∏—Ç–æ!");
                    renderStaking(); saveGame();
                }
            });
        };

        function calcStaking() {
            if(game.staking.activePlan === -1) return;
            let now = Date.now();
            let plan = STAKING_PLANS[game.staking.activePlan];
            let yieldPerSec = plan.yieldDay / 86400;
            let delta = (now - game.staking.lastCalc) / 1000;

            if(delta >= 1) {
                game.staking.accumulated += (yieldPerSec * delta);
                game.staking.lastCalc = now;
                document.getElementById('stakingBalance').innerText = Math.floor(game.staking.accumulated).toLocaleString();
                saveGame();
            }
        }

        window.harvestStaking = () => {
            let val = Math.floor(game.staking.accumulated);
            if(val > 0) {
                game.balance += val;
                game.staking.accumulated = 0;
                TG.showAlert(`üí∞ –û—Ç—Ä–∏–º–∞–Ω–æ ${val.toLocaleString()} –º–æ–Ω–µ—Ç!`);
                renderUI(); saveGame();
                document.getElementById('stakingBalance').innerText = "0.00";
            }
        };

        // --- NFT (10M Cost) ---
        window.mintVoucher = () => {
            const price = 10000000; // 10 Million
            if(game.balance >= price) {
                game.balance -= price;
                game.vouchers = (game.vouchers || 0) + 1;
                TG.showAlert("‚úÖ UCBG Voucher –ø—Ä–∏–¥–±–∞–Ω–æ!");
                renderUI(); saveGame();
            } else {
                TG.showAlert(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤. –¶—ñ–Ω–∞: ${price.toLocaleString()}`);
            }
        };

        // --- UPGRADES ---
        function renderUpgrades() {
            const list = document.getElementById('upgradesList');
            list.innerHTML = '';
            const items = [
                { id: 'tap', name: "–°–∏–ª–∞ –ö–ª—ñ–∫—É", desc: "–†—ñ–≤–µ–Ω—å –∞—Ç–∞–∫–∏" },
                { id: 'eng', name: "–ó–∞–ø–∞—Å –ï–Ω–µ—Ä–≥—ñ—ó", desc: "–ú–∞–∫—Å–∏–º—É–º –∑–∞—Ä—è–¥—É" },
                { id: 'reg', name: "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è", desc: "–®–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞—Ä—è–¥—É" }
            ];
            items.forEach(i => {
                let u = game.upgrades[i.id];
                let cost = Math.floor(u.base * Math.pow(u.factor, u.lvl - 1));
                list.innerHTML += `
                <div class="upg-row">
                    <div>
                        <div style="font-weight:bold;">${i.name} <span style="color:var(--accent-blue)">Lvl ${u.lvl}</span></div>
                        <div style="font-size:11px; color:#888;">${i.desc}</div>
                    </div>
                    <button class="btn" onclick="buy('${i.id}', ${cost})">${cost.toLocaleString()}</button>
                </div>`;
            });
        }

        window.buy = (id, cost) => {
            if(game.balance >= cost) {
                game.balance -= cost;
                game.upgrades[id].lvl++;
                if(id === 'eng') game.upgrades.eng.val += 500;
                if(id === 'reg') game.upgrades.reg.val += 2;
                renderUI(); renderUpgrades(); saveGame();
            } else {
                TG.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤");
            }
        };

        window.activateRocket = () => {
            if(Date.now() > game.turboEnd) {
                game.turboEnd = Date.now() + 10000;
                TG.showAlert("üöÄ –¢–£–†–ë–û –ê–ö–¢–ò–í–û–í–ê–ù–û!");
                document.getElementById('upgModal').style.display='none';
            }
        };

        // --- TASKS & FRIENDS ---
        window.checkTask = (id, url) => {
            if(game.tasks[id]) return;
            TG.openTelegramLink(url);
            setTimeout(() => {
                TG.showConfirm("–ü—ñ–¥–ø–∏—Å–∞–ª–∏—Å—è?", (ok) => {
                    if(ok) {
                        game.tasks[id] = true;
                        game.balance += 1000000;
                        updateTasksUI(); renderUI(); saveGame();
                    }
                });
            }, 3000);
        };

        function updateTasksUI() {
            if(game.tasks.task1) { document.getElementById('task1Btn').innerText = "‚úì"; document.getElementById('task1Btn').disabled = true; }
            if(game.tasks.task2) { document.getElementById('task2Btn').innerText = "‚úì"; document.getElementById('task2Btn').disabled = true; }
        }

        window.invite = () => {
            const userId = TG.initDataUnsafe?.user?.id || "";
            const url = `https://t.me/ucbgcoin_bot/Ucbgcoin?startapp=${userId}`;
            TG.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(url)}`);
            
            // Sim fake friend
            setTimeout(() => {
                if(game.friends.length < 5) {
                    game.friends.push(`Soldier_${Math.floor(Math.random()*999)}`);
                    game.balance += 500000;
                    renderFriends(); renderUI(); saveGame();
                    TG.showAlert("–ù–æ–≤–∏–π —Ä–µ–∫—Ä—É—Ç –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è!");
                }
            }, 5000);
        };

        function renderFriends() {
            const list = document.getElementById('friendsList');
            if(game.friends.length > 0) {
                list.innerHTML = '';
                game.friends.forEach(f => {
                    list.innerHTML += `<div class="friend-item"><span>üë§ ${f}</span><span style="color:#28a745">+500k</span></div>`;
                });
            }
        }

        // --- CORE UI ---
        function renderUI() {
            elBalance.innerText = game.balance.toLocaleString();
            let cur = Math.floor(game.energy); let max = game.upgrades.eng.val;
            elEnVal.innerText = cur; elEnMax.innerText = max;
            elEnergyFill.style.width = (cur/max)*100 + "%";
            
            document.getElementById('voucherCount').innerText = game.vouchers || 0;
            
            let lInfo = LEAGUES[game.leagueIndex];
            elLeague.innerText = lInfo.name;
            elLeague.style.color = lInfo.color;
        }

        window.openModal = (id) => document.getElementById(id).style.display = 'flex';
        window.closeModals = () => document.querySelectorAll('.modal').forEach(el => el.style.display = 'none');

        // NEW SAVE KEY FOR CLEAN START (v1.7)
        function saveGame() { localStorage.setItem('ucbg_v1_7_light', JSON.stringify(game)); }
        function loadGame() {
            let s = localStorage.getItem('ucbg_v1_7_light');
            if(s) { 
                let d = JSON.parse(s); game = {...game, ...d};
                if(!game.staking) game.staking = { activePlan: -1, accumulated: 0, lastCalc: Date.now() };
            } else {
                game.balance = 5000; // Start Bonus
            }
        }

        window.onload = init;
    </script>
</body>
</html>
